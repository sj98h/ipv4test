<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
</head>
<!-- 파이어베이스 스토리지 -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"></script>
<!-- 제이쿼리 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- 파이어베이스 -->
<script type="module">
  // Firebase SDK 라이브러리 가져오기
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
  import {
    collection,
    addDoc,
  } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
  import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
  // 스토리지
  // import { getStorage } from "firebase/storage";
  import {getStorage} from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";
  // Firebase 구성 정보 설정
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyC5fodfunsbkD_YEDYmzpBa-ixZQnGbjV8",
    authDomain: "ipv4-659be.firebaseapp.com",
    projectId: "ipv4-659be",
    storageBucket: "ipv4-659be.appspot.com",
    messagingSenderId: "1009613858218",
    appId: "1:1009613858218:web:8803e07dfa4b62634977d3",
    measurementId: "G-VTWB9NL8HX",
  };

  // Firebase 인스턴스 초기화
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // $("#savebtn").click(async function () {
  //   $("#여기들어갈건 멤버카드").toggle();
  // });

  // 모달 스크립트입니다
  const modalBtn = document.querySelector(".modalss");
  const closeBtn = document.querySelector(".closeModal");
  // const modalWindow = document.querySelector(".modalWindow");

  modalBtn.addEventListener("click", () => {
    $('.modalWindow').show()
  });
  closeBtn.addEventListener("click", () => {
    $('.modalWindow').hide()
  })

  //등록 버튼
  //    const submitBtn = document.querySelector("#qwebtn");
  //     submitBtn.addEventListener("click", () => {
  //       alert('완료');
  //     });
  $('#qwebtn').click(async function () {
    let pfimg = $('#pfimg').val();
    let pfname = $('#pfname').val();
    let pfhobby = $('#pfhobby').val();
    let pfint = $('#pfint').val();
    let pfgoals = $('#pfgoals').val();
    let pfdtr = $('#pfdtr').val();
    let doc = {
      pfimg: pfimg,
      pfname: pfname,
      pfhobby: pfhobby,
      pfint: pfint,
      pfgoals: pfgoals,
      pfdtr: pfdtr
    }

    alert('테스트');

    // 파이어베이스 스토리지
    const storage = getStorage(app);
    console.log(storage)
    // 이미지파일 변수의 저장
    var file = $('#pfimg').files[0];
    // 기본골격
    var storageRef = storage.ref();
    // 저장할경로
    var pathImg = storageRef.child('image/' + 'abcd');
    // 업로드작업
    pathImg.put(file)
    // const storageRef = ref(storage, 'images/' + pfimgFile.name);
    // await uploadBytes(storageRef, pfimgFile);
    // const imgURL = await getDownloadURL(storageRef);

    await addDoc(collection(db, 'inputdata'), doc);
    window.location.reload();
  })


  async function displayCards() {
    const querySnapshot = await getDocs(collection(db, 'inputdata'));
    querySnapshot.forEach((doc) => {
      const data = doc.data();
      let temp_html = `
    <div class="col">
      <div class="card h-100">
        <img class="img_cards" src="${data.pfimg}" class="card-img-top" alt="..." />
        <div class="card-body">
          <h5 class="card-title">${data.pfname}</h5>
        </div>
      </div>
    </div>`;
      $('.cards').append(temp_html);
    });
  }

  $(document).ready(function () {
    displayCards();
  });

</script>

<style>
  @import url(../css/style.css);
</style>

<body>
  <!-- 모달 -->
  <div class="modalWindow">
    <p class="closeModal">X</p>

    <div class="input-group imgfile">
      <input accept="img/*" type="file" class="form-control" id="pfimg">
      <label class="input-group-text" for="pfimg">Upload</label>
    </div>

    <div class="nametxt">
      <input placeholder="이름을 입력해주세요." type="text" id="pfname">
      <input placeholder="MBTI를 입력하세요." type="text">
    </div>

    <div class="hobbytxt">
      <input placeholder="취미" type="text" id="pfhobby">
      <input placeholder="blog 주소 입력" type="text">
    </div>

    <div class="input-group itr">
      <span class="input-group-text">관심사</span>
      <textarea class="form-control" aria-label="With textarea" id="pfint"></textarea>
    </div>

    <div class="input-group goals">
      <span class="input-group-text">목표</span>
      <textarea class="form-control" aria-label="With textarea" id="pfgoals"></textarea>
    </div>

    <div class="input-group dtn">
      <span class="input-group-text">각오</span>
      <textarea class="form-control" aria-label="With textarea" id="pfdtr"></textarea>
    </div>

    <div class="btnbtn">
      <button class="qwe" id="qwebtn">등록하기</button>
    </div>


    <!-- 컨텐츠 쭉 쓰시면 됩니다 -->
  </div>
  <!-- //모달끝 -->

  <header>
    <p>SoD</p>
  </header>
  <div class="btndiv">
    <button type="button" class="btn btn-outline-light">HOME</button>
    <button type="button" class="btn btn-outline-light">MEMBERS</button>
    <button type="button" class="btn btn-outline-light">NEWS</button>
  </div>
  <div class="row row-cols-1 row-cols-md-4 g-4 cards" id="cards">
    <div class="col">
      <div class="card h-100">
        <img class="img_cards" id="imgid" src="" class="card-img-top" alt="..." />
        <div class="card-body">
          <h5 class="card-title" id="nameid">이름</h5>
        </div>
      </div>
    </div>
  </div>

  <div class="savebutton">
    <button class="btn btn-outline-light modalss">멤버 추가하기</button>
  </div>
  </div>
</body>

</html>