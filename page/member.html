<!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  </head>

<body>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
    import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js';


    const firebaseConfig = {
      apiKey: "AIzaSyC5fodfunsbkD_YEDYmzpBa-ixZQnGbjV8",
      authDomain: "ipv4-659be.firebaseapp.com",
      projectId: "ipv4-659be",
      storageBucket: "ipv4-659be.appspot.com",
      messagingSenderId: "1009613858218",
      appId: "1:1009613858218:web:8803e07dfa4b62634977d3",
      measurementId: "G-VTWB9NL8HX",
    };


    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    //===============================================

    $('#qwebtn').click(async function () {
      const pfimgInput = $('#pfimg')[0];
      const pfname = $('#pfname').val();
      const pfhobby = $('#pfhobby').val();
      const pfint = $('#pfint').val();
      const pfgoals = $('#pfgoals').val();
      const pfdtr = $('#pfdtr').val();
      const pfmbti = $('#pfmbti').val();
      const pfblog = $('#pfblog').val();

      const file = pfimgInput.files[0];

      if (!file) {
        alert('업로드할 파일을 올려주세요.');
        return;
      }


      const storageRef = ref(storage, 'images/' + file.name);


      try {
        await uploadBytes(storageRef, file);
        const downloadURL = await getDownloadURL(storageRef);


        const doc = {
          pfimg: downloadURL,
          pfname: pfname,
          pfhobby: pfhobby,
          pfint: pfint,
          pfgoals: pfgoals,
          pfdtr: pfdtr
        };


        await addDoc(collection(db, 'inputdata'), doc);
        alert('성공했습니다.');
        window.location.reload();
      } catch (error) {
        console.error('에러', error);
        alert('에러');
      }
    });

    async function displayCards() {
      const querySnapshot = await getDocs(collection(db, 'inputdata'));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const temp_html = `
            <div class="col">
              <div class="card h-100">
                <img class="img_cards" src="${data.pfimg}" class="card-img-top" alt="..." />
                <div class="card-body">
                  <h5 class="card-title">${data.pfname}</h5>
                </div>
              </div>
            </div>`;
        $('.cards').append(temp_html);
      });
    }

    $(document).ready(function () {
      displayCards();
      // 카드 렌더링 후 카드 클릭 부분
      $('.cards').on('click', '.card', function() {
    // 클릭된 카드의 인덱스 계산
    const cards = $('.cards .card');
    const index = cards.index($(this));
    alert(`선택한 박스의 index는 ${index}입니다.`);
  });
    });


    // 모달 스크립트입니다
    const modalBtn = document.querySelector(".modalss");
    const closeBtn = document.querySelector(".closeModal");

    modalBtn.addEventListener("click", () => {
      $('.modalWindow').show()

    });
    closeBtn.addEventListener("click", () => {
      $('.modalWindow').hide()
    })


    // 클릭 모달
    // const clickModalCard = document.querySelectorAll(".cards .card");


    
    const clickCloseBtn = document.querySelector(".btn-close");

    clickCloseBtn.addEventListener("click", () => {
      $('.clickmodal').hide()
    })
  </script>

  <style>
    @import url(../css/style.css);
  </style>

  <body>
    <!-- 모달 -->
    <div class="modalWindow">
      <p class="closeModal">X</p>

      <div class="input-group imgfile">
        <input accept="img/*" type="file" class="form-control" id="pfimg">
        <label class="input-group-text" for="pfimg">Upload</label>
      </div>

      <div class="nametxt">
        <input placeholder="이름을 입력해주세요." type="text" id="pfname">
        <input placeholder="MBTI를 입력하세요." type="text">
      </div>

      <div class="hobbytxt">
        <input placeholder="취미" type="text" id="pfhobby">
        <input placeholder="blog 주소 입력" type="text">
      </div>

      <div class="input-group itr">
        <span class="input-group-text gray-box">관심사</span>
        <textarea class="form-control" aria-label="With textarea" id="pfint"></textarea>
      </div>

      <div class="input-group goals">
        <span class="input-group-text gray-box">목표</span>
        <textarea class="form-control" aria-label="With textarea" id="pfgoals"></textarea>
      </div>

      <div class="input-group dtn">
        <span class="input-group-text gray-box">각오</span>
        <textarea class="form-control" aria-label="With textarea" id="pfdtr"></textarea>
      </div>

      <div class="btnbtn">
        <button class="qwe" id="qwebtn">등록하기</button>
      </div>


      <!-- 컨텐츠 쭉 쓰시면 됩니다 -->
    </div>
    <!-- //모달끝 -->

    <!-- 카드클릭모달 -->
    <div class="clickmodal">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalCenteredScrollableTitle">Modal title</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="bodymodal">

        <div class="modal1">

          <div class="modalimg">
          </div>

          <div class="modaltxt">
            <h3>MBTI</h3>
            <p>mbti자리입니다</p>
            <h3>취미</h3>
            <p>취미자리입니다</p>
            <h3>blog</h3>
            <p>blog자리입니다</p>
          </div>
        </div>
        <div class="modal2">
          <h3>계기</h3>
          <p>계기자리입니다</p>
          <h3>목표</h3>
          <p>목표자리입니다</p>
          <h3>각오</h3>
          <p>각오자리입니다</p>
        </div>
      </div>
    </div>
    <!-- 카드클릭모달끝 -->

    <header>
      <p>SoD</p>
    </header>
    <div class="btndiv">
      <button type="button" class="btn btn-outline-light">HOME</button>
      <button type="button" class="btn btn-outline-light">MEMBERS</button>
      <button type="button" class="btn btn-outline-light">NEWS</button>
    </div>
    <!-- 이름 카드 -->
    <div class="row row-cols-1 row-cols-md-4 g-4 cards">
      <!-- 기본 골격 -->
      <!-- <div class="col">
      <div class="card h-100">
        <img class="img_cards" id="imgid" src="" class="card-img-top" alt="..." />
        <div class="card-body">
          <h5 class="card-title" id="nameid">이름</h5>
        </div>
      </div>
    </div> -->
    </div>

    <div class="savebutton">
      <button class="btn btn-outline-light modalss">멤버 추가하기</button>
    </div>
    </div>
  </body>

</html>